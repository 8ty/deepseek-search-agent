name: ğŸ› ï¸ å¼€å‘ç¯å¢ƒè°ƒè¯•

on:
  workflow_dispatch:
    inputs:
      test_query:
        description: 'è°ƒè¯•æµ‹è¯•ç”¨ä¾‹'
        required: true
        type: string
        default: 'å¦‚ä½•ä½¿ç”¨ React 18 çš„æ–°ç‰¹æ€§ï¼Ÿ'
      webhook_endpoint:
        description: 'æµ‹è¯•å›è°ƒç«¯ç‚¹'
        required: false
        type: string
        default: 'https://your-app.vercel.app/api/webhook'
      iteration_limit:
        description: 'æµ‹è¯•è¿­ä»£é™åˆ¶'
        required: false
        type: string
        default: '2'

jobs:
  debug-tests:
    runs-on: ubuntu-latest
    permissions:
      actions: write
      contents: read
    
    steps:
    - name: ğŸ”§ å‡†å¤‡å¼€å‘ç¯å¢ƒ
      uses: actions/checkout@v4
      
    - name: ğŸ é…ç½®Pythonè°ƒè¯•ç¯å¢ƒ
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
        cache: 'pip'
        
    - name: ğŸ“¦ å®‰è£…å¼€å‘ä¾èµ–
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        
    - name: ğŸ§ª è¿è¡Œå¼€å‘æµ‹è¯•
      env:
        OPENROUTER_API_KEY: ${{ secrets.OPENROUTER_API_KEY }}
        JINA_API_KEY: ${{ secrets.JINA_API_KEY }}
        ENVIRONMENT: "development"
        SEARCH_QUERY: ${{ inputs.test_query }}
        CALLBACK_URL: ${{ inputs.webhook_endpoint }}
        WORKSPACE_ID: dev-debug-${{ github.run_number }}
        MAX_ROUNDS: ${{ inputs.iteration_limit }}
        INCLUDE_SCRAPING: 'true'
        DEBUG_MODE: 'true'
        SILENT_MODE: 'false'
        GITHUB_REPOSITORY: ${{ github.repository }}
        GITHUB_REF: ${{ github.ref }}
        GITHUB_SHA: ${{ github.sha }}
        GITHUB_ACTIONS: "true"
        RUNNER_OS: ${{ runner.os }}
      run: |
        echo "ğŸ› ï¸ å¼€å‘ç¯å¢ƒè°ƒè¯•æ¨¡å¼"
        echo "ğŸ“‹ æµ‹è¯•ç”¨ä¾‹: $SEARCH_QUERY"
        echo "ğŸ“ å›è°ƒç«¯ç‚¹: $CALLBACK_URL"
        echo "ğŸ  ç¯å¢ƒæ ‡è¯†: $WORKSPACE_ID"
        echo "ğŸ”„ è¿­ä»£é™åˆ¶: $MAX_ROUNDS"
        echo "ğŸ”§ æ‰©å±•åŠŸèƒ½: $INCLUDE_SCRAPING"
        echo "ğŸŒ è¿è¡Œæ¨¡å¼: $ENVIRONMENT"
        echo "ğŸ” è¯¦ç»†æ—¥å¿—: $DEBUG_MODE"
        echo "ğŸ”‡ ç®€æ´è¾“å‡º: $SILENT_MODE"
        echo ""
        echo "ğŸš€ å¼€å§‹å¼€å‘æµ‹è¯•..."
        echo ""
        
        # å¼€å‘è°ƒè¯•æ¨¡å¼æ˜¾ç¤ºæ‰€æœ‰è¾“å‡º
        python -m api.github_runner
        
    - name: ğŸ“Š å¼€å‘æµ‹è¯•æŠ¥å‘Š
      if: always()
      run: |
        echo "âœ… å¼€å‘ç¯å¢ƒæµ‹è¯•å®Œæˆ"
        echo "â° æ‰§è¡Œæ—¶é—´: $(date)"
        echo "ğŸ”§ è¿è¡Œç¯å¢ƒ: ${{ runner.os }}"
        echo "ğŸ Python ç‰ˆæœ¬: $(python --version)"
        echo ""
        echo "ğŸ“ å¼€å‘æç¤ºï¼š"
        echo "1. æ£€æŸ¥ä¸Šè¿°æ—¥å¿—ä¸­çš„webhookè°ƒç”¨ä¿¡æ¯"
        echo "2. ç¡®è®¤å›è°ƒç«¯ç‚¹æ˜¯å¦æ­£ç¡®å“åº”"
        echo "3. æŸ¥çœ‹æ˜¯å¦æœ‰APIè°ƒç”¨é”™è¯¯"
        echo "4. åœ¨åº”ç”¨ä¸­æŸ¥çœ‹æµ‹è¯•ID: dev-debug-${{ github.run_number }}" 